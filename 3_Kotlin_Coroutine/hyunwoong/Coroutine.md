|Topic| Description|Author |
|--|--|--|
| Coroutine |  | 남현웅

## **Coroutine**

#### 코루틴이란?
동시성 프로그래밍 개념을 코틀린에 도입한 것을 코루틴이라고 한다. 코루틴이 시작된 스레드를 중단하지 않으면서 비동기적으로 실행되는 코드이다. 여러 스레드 관리를 해줄 필요가 없고, 다중 스레드보다 효율적으로 동작한다.

> 안드로이드 공식 문서
> Android에서 코루틴은 기본 스레드를 차단하여 앱이 응답하지 않게 만들 수도 있는 장기 실행 작업을 관리하는 데 도움이 됩니다. 코루틴을 사용하는 전문 개발자 중 50% 이상이 생산성이 향상되었다고 보고했습니다. 

#### 코루틴의 장점?
코루틴은 스레드 위에서 실행되는데, 한 작업이 이뤄지다 다른 작업이 실행되어도 스레드를 정지하여 Context Switching 개념으로 다른 스레드로 전환하는것이 아닌 기존 스레드를 유지하며 다른 작업이 진행된다.
한마디로 스레드가 멈추지 않고 루틴을 돌릴 수 있게되며, 이로인해 성능 향상을 기대할 수 있고 훨씬 적은 자원 소모를 하게된다.

## Dispatcher
코루틴에서 스레드 풀을 만들고, Dispatcher를 통해 코루틴을 배분한다. 코루틴을 만들고 해당 코루틴을 Dispatcher에 전송하면 Dispatcher는 자신이 관리하는 스레드풀 내의 스레드 부하 상황에 맞춰 코루틴을 배분한다.

#### 디스패처 사용법
```
CoroutineScope(Dispatchers.Main).launch {
	// 필요한 작업 수행
}
```

- 리턴이 필요 없을때는 launch, 필요할 때는 async를 사용한다.
- 코루틴을 생성할 때 Dispatcher를 설정하는 것만으로 Dispatcher의 전환이 가능하다.

## Suspend fun
비동기 작업을 하다보면 중간에 일시 중단 하는 단계가 필요한 경우가 많다. 이때 코루틴에서는 해당 코루틴을 잠시 일시 중단 가능하도록 한다.
코루틴 일시 중단은 코루틴 블록 내부에서 수행되어야 한다. 
Suspend fun은 일시 중단 가능한 함수를 지칭하는 것으로, 해당 함수는 코루틴 내부에서 수행되어야 한다.
* suspend fun은 suspend fun에서 수행될 수 있다!

## Job, Cancel

코루틴을  `launch`  시키면  `job`을 반환하게 된다. 이제 이  `job`을 다른 코루틴에 넣어서 실행시킬 수도 있고, 실행 중에 멈추게(cancel)할 수도 있다.

## Scope
글로벌 스코프는 어플리케이션이 종료될 때 까지 살아있다. 즉 액티비티 내에서  `finish()`를 하더라도 계속 살아있게 된다.

이렇게 되면 코루틴이  `finish`  된 액티비티의 리소스들을 계속해서 잡고 있으므로 JVM의 가비지 컬렉터가 제 할일을 못하게 되므로 메모리 누수의 원인이 될 수 있다. 그래서 코루틴은 다른 스코프들도 지원한다.

`lifeCycleScope`로 코루틴을 실행하면 현재 액티비티의 라이프 사이클에 의존하게 된다. 따라서 액티비티가 종료되면(finish메소드) 액티비티 내 lifecycleScope로 실행된 코루틴들은 전부 종료가 된다.

또는  `coroutineScope`  빌더를 사용하여 코루틴의 고유한 스코프를 선언할 수 있다. 이렇게 생성된 스코프는 실행된 모든 하위 코루틴이 완료되면 끝이 난다.

#### 참고 사이트
https://velog.io/@peppermint100/%EC%95%88%EB%93%9C%EB%A1%9C%EC%9D%B4%EB%93%9C-%EC%BD%94%EB%A3%A8%ED%8B%B4-1
https://developer.android.com/kotlin/coroutines?hl=ko
https://kotlinworld.tistory.com/
